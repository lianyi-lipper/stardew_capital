期货Mod：完整设计总纲

# 一、 核心概念与目标

- **目标**：在《星露谷物语》中引入一个高真实度的商品期货市场，让玩家（农场主）能够：
  1. **管理风险（套期保值）**：锁定未来农作物的售价，对抗市场波动。
  2. **方向投机（杠杆交易）**：利用保证金杠杆，对未来价格进行方向性押注。
  3. **高级套利（期现联动）**：利用期货与现货之间的价差（基差）进行套利。

# 二、 核心游戏循环

1. **套期保值（Hedge）**：
   - **场景**：春季第1天，玩家种下1000个防风草。此时期货价格（$P_{\text{future}}$）为40g。玩家担心季末价格暴跌。
   - **操作**：玩家“卖出开仓”10手“春季防风草-28天合约”，锁定40g的卖价。
   - **结果 (Day 28)**：
     - **A. 价格暴跌**：现货价（$P_{\text{spot}}$）跌至20g。玩家现货少赚了20g/个。但期货合约盈利 (40g-20g) x 1000，完美弥补了亏损。
     - **B. 价格暴涨**：现货价（$P_{\text{spot}}$）涨至60g。玩家现货多赚了20g/个。但期货合约亏损 (40g-60g) x 1000，抵消了超额收益。
   - **最终效果**：无论价格如何，玩家的总收入都被锁定在40g/个，实现了风险管理。
2. **投机 (Speculate)**：
   - 玩家预期“害虫危机”会导致价格上涨。他只需支付10%的保证金（例如4g/个），就能“买入开仓”10手合约。如果价格如期上涨到60g，他将获得巨额杠杆回报。如果价格下跌，他可能血本无归（强制平仓）。
3. **期现套利 (Arbitrage)**：
   - 玩家发现 $P_{\text{future}}$ (40g) 远高于 $P_{\text{spot}}$ (35g) + 持有成本 (1g)。他会立刻“买入现货”（35g），同时“卖出期货”（40g），锁定4g的无风险利润。这种行为会（通过我们设计的“价格冲击”机制）反过来把价差拉回合理水平。

# 三、 核心机制：实物交割与风险

- **合约**：标准化的（例如“春季防风草-28天合约”，1手 = 100个）。
- **保证金**：交易采用保证金制度，高杠杆与高风险并存。
- **每日结算**：根据当日收盘价结算持仓盈亏，保证金不足会收到“追保通知”，未及时补足则“强制平仓”。
- **实物交割（Day 28）**：
  - **玩家持有多单（Long）**：合约到期，系统自动通过邮件向玩家发送100个/手防风草。
  - **玩家持有空单（Short）**：合约到期，系统检查玩家库存（或指定交割箱）。
  - **空单违约**：如果玩家未能足额交付100个/手的防风草，将视为“违约”，**没收其全部保证金**作为惩罚。这是除强平外的最严厉惩罚。



# 四、 核心引擎：价格波动模型

## 模型一：$S_T$ (最终结算现货价)

这是 $T$ 日的“真相”。它由游戏“宏观经济”的最终基本面决定，并受到“黑天鹅”新闻的影响。

$$S_T = P_{\text{base}} \cdot \lambda_s \cdot \left( \frac{D_{\text{base}} + \sum_{t=1}^{T} D_{\text{news}}(t)}{S_{\text{base}} + \sum_{t=1}^{T} S_{\text{news}}(t)} \right)$$

- **$S_T$ (Final Spot Price):** 交割日的最终结算价。

- **$P_{\text{base}}$ (Base Price):** 物品的基础售价（例如，防风草 = 35g）。

- **$\lambda_s$ (Seasonal Multiplier):** 季节性乘数。

  - 如果 $T$ 日在作物的*生长季*，$\lambda_s = 1$。

  - 如果 $T$ 日在*非生长季*（例如，冬天的草莓），$\lambda_s$ 是一个高值（例如 $5.0$），代表了温室或进口的稀缺性。

- **$D_{\text{base}}$ (基础需求):**

  - **含义：** 在一个“正常”的28天里，没有任何新闻，鹈鹕镇对防风草的“标准”总需求量。

  - **举例：** 我们可以设定一个标准值，比如 $D_{\text{base}} = 10,000$ 单位。这是一个固定的数字，代表了经济的基线。

- **$S_{\text{base}}$ (基础供给):**
  - **含义：** 在一个“正常”的28天里，没有任何新闻，农民们“标准”的总收获量。
  - **举例：** 为了简化，我们也设定 $S_{\text{base}} = 10,000$ 单位。
  - *(当 $D_{\text{base}} = S_{\text{base}}$ 时，供需平衡，价格 $\frac{D}{S} = 1$，所以 $S_T = P_{\text{base}}$。)*

- **$D_{\text{news}}(t)$ (t日的需求新闻):**
  - **含义：** 在 $t$ 日发生的这件新闻，使**最终的总需求**增加了多少或减少了多少。
  - **举例 (Zuzu 市订单):**
    - 这个订单意味着总需求**一次性**增加了 3,000 单位。所以 $D_{\text{news}}(2) = +3000$。
    - 在**没有**需求新闻的 $t$ 日（比如第3天），$D_{\text{news}}(3) = 0$。
- **$S_{\text{news}}(t)$ (t日的供给新闻):**
  - **含义：** 在 $t$ 日发生的这件新闻，使**最终的总供给**增加了多少或减少了多少。
  - **举例 (歉收):**
    - 这场灾害意味着总供给**一次性**减少了 2,000 单位。所以 $S_{\text{news}}(5) = -2000$。
  - **举例 (丰收):** $S_{\text{news}}(6) = +1500$。

## 模型二：$S_t$ (每日现货价格的随机过程)

这是实现“随机波动”的核心。$S_t$（今天的现货价）是 $S_{t-1}$（昨天的现货价）的函数，并受到“新闻”和“运气”的影响。

我们使用一个离散时间的**几何布朗运动 (GBM)** 公式：

$$\ln(S_{t+1}) = \ln(S_t) + \alpha_t (\ln(E_t[S_T^*]) - \ln(S_t)) + \sigma_t W_{t+1}$$，其中 $$t \in \{1, 2, \dots, T-1\}$$

- **$S_{t+1}$:** 明天的现货价格。

- **$S_t$:** 今天的现货价格。

- **$\alpha_t$ (拉力系数):**
  - **含义:** 这是“拉力”的强度。它必须随着时间 $t$ 靠近 $T$ 而**逐渐增强**。
  - **逻辑:** 刚开始（$t$ 很小），$S_t$ 可以离预期远一点；但快到交割日了（$t \to T$），$S_t$ 必须被强行拉向 $E_t[S_T^*]$。
  - **公式:** $\alpha_t = \frac{1}{T - t}$。（在 $t=0$ 时，拉力很弱，例如 $\frac{1}{28}$；在 $t=T-1$ 时，拉力很强，为 ${1}$）。
  - 请注意，我们不需要担心$T=t$的情况，因为$t$的取值是$1$到$T-1$

- **$E_t[S_T^*]$ (市场的最佳猜测):**

  - **含义:** 这是在 $t$ 日，市场综合了所有已知新闻后，对 $S_T$的“基本面”的最佳猜测值。
  - **公式：**$$E_t[S_T^*] = P_{\text{base}} \cdot \lambda_s \cdot \left( \frac{D_{\text{base}} + \sum_{i=1}^{t} D_{\text{news}}(i)}{S_{\text{base}} + \sum_{i=1}^{t} S_{\text{news}}(i)} \right)$$

- **$\sigma_t$ (波动率 / 随机性):**
- **含义:** 这是每日的随机波动幅度。它必须随着时间 $t$ 靠近 $T$ 而**逐渐减弱**。
  
- **逻辑:** 离交割日越远，不确定性越大，波动也越大。离交割日越近，信息越明确，波动应该越小。
  
- **公式:**$$\sigma_t = \sigma_{base} \cdot \sqrt{T - t}$$。$\sigma_{\text{base}}$ 是一个基础波动常数（由“运气”决定）。
  - 电视播报“运气极好”: $\sigma_{\text{base}} = 0.01$ (市场稳定，波动小)。
  
  - 电视播报“运气很差”: $\sigma_{\text{base}} = 0.05$ (市场恐慌，波动大)。

- **$W_t$ (Wiener Process):** 维纳过程的离散形式。

  - 在代码中，这只是一个**从标准正态分布 $N(0, 1)$ 中抽取的随机数** (均值为0，标准差为1)。

##  模型三：$F_t$ (每日期货价格 - 持有成本模型)

这是玩家*实际交易*的期货合约价格。它严格遵守金融的**持有成本 (Cost-of-Carry) 套利模型**。

$$F_t = S_t \cdot e^{(r + \phi - q) \cdot (T - t)}$$

- **$F_t$ (Futures Price):** 在 $t$ 日交易的、 $T$ 日交割的期货合约价格。
- **$S_t$ (Spot Price):** **今天的现货价格（由模型二 $S_t$ 给出）**。
- **$(T - t)$:** 距离交割日的天数（$\tau$）。
- **$r$ (Risk-Free Rate / 每日无风险利率):**
  - **含义:** 金币的时间价值。
  - **游戏逻辑:** 你今天把作物卖了换成 100g，可以马上买种子（机会成本）。这个 $r$ 必须为正。
  - **建议值:** $r = 0.002$ (即每日 0.2% 的利息)。
- **$\phi$ (Storage Cost / 每日仓储与腐败成本):**
  - **含义:** 持有现货的成本。
  - **游戏逻辑:** 作物（特别是低品质的）会腐败。
  - **建议值:** $\phi = 0.005$ (即每日 0.5% 的腐败损耗)。
- **$q$ (Convenience Yield / 每日便利收益率):**
  - **含义:** *物理持有*现货带来的好处。
  - **游戏逻辑:** 这是星露谷的核心！持有现货可以送礼、烹饪、完成任务。
  - **建议值:** 这是一个动态值！
    - 平时: $q = 0.001$ (每日 0.1%)。
    - **事件驱动:** 明天是海莉的生日，她喜欢“太阳花”。那么今天“太阳花”的 $q$ 会飙升到 $q = 0.10$ (10%)



## 模型四：$P(\tau)$ (日内微观结构 - 增量递归布朗桥

本模型采用**离散化的均值回归过程 (Discrete Mean-Reversion Process)**，旨在模拟价格在日内交易中的随机游走及其向目标价位的收敛特性。

### 1. 核心演化方程

每一帧（Tick）的价格 $P_{\tau+1}$ 由“上一帧价格”、“回归引力”和“动态噪音”三部分组成：

$$P_{\tau+1} = P_{\tau} + \underbrace{\frac{P_{target} - P_{\tau}}{T_{remain}}}_{\text{回归引力 (Gravity)}} + \underbrace{\sigma_{intra} \cdot \Psi(\tau) \cdot \epsilon}_{\text{动态噪音 (Dynamic Noise)}}$$

- **$\tau$ (Current Tick):** 当前时刻指针。系统仅需知晓“现在在哪里”和“现在几点”，无需记录路径起点。

- **$P_{\tau}$ (当前价格):** 上一帧（或上一 Tick）的结算价。

- **$T_{remain}$ (剩余时间):** 距离强制收盘（如 5:00 PM）还剩多少个 Ticks。

  > **收敛逻辑：** $T_{remain}$ 作为第一项的分母。当 $T_{remain} \to 0$ 时，回归引力的权重趋于无穷大，强制价格在收盘时精准收敛于 $P_{target}$。

- **$\epsilon$ (Random Walk):** 服从标准正态分布 $N(0,1)$ 的随机数。

  > **作用：** 这不仅是噪音，更是驱动价格游走的动力，确保 K 线呈现连续的布朗运动特征。

### 2. 波动率优化：微笑曲线因子 $\Psi(\tau)$

为了解决“早盘死水”和“收盘过于机械”的问题，引入波动率微笑 (Volatility Smile) 因子。

$$\Psi(\tau) = \underbrace{(1 + \alpha \cdot e^{-\lambda \cdot \tau_{elapsed}})}_{\text{开盘活跃衰减}} \cdot \underbrace{\sqrt{\frac{T_{remain}}{T_{total}}}}_{\text{收盘收敛包络}}$$

- **设计意图：** 模拟真实市场开盘时的混乱与活跃，同时保留收盘时的强制收敛特性。
- **视觉效果：**
  - **6:00 AM (开盘):** 波动率极高，用于消化隔夜情绪。
  - **盘中:** 波动率逐渐平稳。
  - **2:00 AM (收盘):** 波动率归零，曲线闭合。

### 3. 事件驱动机制 (Event-Driven)

当 $t$ 时刻发生突发新闻时，系统将按以下逻辑动态更新：

1. **触发 (Trigger):** 宏观模型计算出全新的目标价 $P_{target}$。
2. **重置 (Reset):**
   - **操作:** 仅需更新 $P_{target} \leftarrow S'_{t+1}$。
   - **优势:** **无需**重置 $\tau$ 或 $P_{start}$，无需复杂回溯。
3. **效果 (Effect):**
   - 下一帧计算时，公式中的 $(P_{target} - P_{\tau})$ 差值瞬间变大。
   - “回归引力”项自动调整方向和力度。
   - **结果:** 价格如同被磁铁吸附一般，自然地（而非生硬地）转向新目标，算法复杂度保持为 $O(1)$。

### 4. 特殊机制：尾盘熔断与隔夜跳空

**(The Overnight Gap)**

为了解决“1:50 AM 发生大新闻导致 K 线垂直崩盘（甚至穿模）”的问题，引入熔断机制。

当满足以下两个条件时触发：

1. **时间紧迫:** $T_{remain} < T_{threshold}$ (例如：最后 1 小时)。
2. **跌幅过大:** $|P_{target} - P_{\tau}| > \text{MaxMove}$。

#### 熔断处理流程

1. 日内锁定: 强制设定当日收盘目标：

   $$P_{close\_today} = P_{\tau} - \text{MaxMove}$$

   (含义：今天最多只能跌这么多)

2. 压力转移: 将未消化的价差计入“隔夜情绪池”：

   $$\text{Gap} = P_{target} - P_{close\_today}$$

3. 次日开盘:

   $$O_{t+1} = S_{t+1} + \text{Gap}$$

> 玩家体验优化:
>
> 如果半夜突发大利空，当晚价格会呈现“跌停”状态（不再强行收敛到极低值，避免图形崩坏）；但第二天早上 6:00 会直接大幅低开。这完美复刻了真实金融市场的“盘后消息消化”与“跳空开盘”机制。

## 模型五：$I(t)$ (市场微观博弈与冲击层 - 独立叠加系统)

这是赋予市场“人性”与“混乱”的灵魂层。

它独立于之前的宏观与日内模型，作为一个**“影子价格 (Shadow Price)”**叠加在理性的基准价格之上。

#### 1. 核心叠加公式

最终玩家在交易所看到的、用于成交的价格 $P_{Final}(t)$ 由两部分组成：

$$P_{Final}(t) = P_{Model}(t) + I(t)$$

- **$P_{Model}(t)$ (理性基准):** 由模型一至模型四计算出的、基于基本面和布朗桥的“上帝视角合理价”。
- **$I(t)$ (市场冲击/情绪溢价):** 由玩家交易、NPC跟风、恐慌或贪婪造成的“价格泡沫”或“洼地”。

#### 2. 冲击演化方程 (The Evolution of Chaos)

冲击值 $I(t)$ 不是静态的，它是一个动态变化的博弈结果。下一帧的冲击值 $I(t+1)$ 取决于当前的残留冲击、玩家的新操作以及三类NPC的反应：

$$I(t+1) = I(t) + \underbrace{\Delta I_{Player}}_{\text{点火}} + \underbrace{\Delta I_{Smart}}_{\text{回归}} + \underbrace{\Delta I_{Trend}}_{\text{趋势}} + \underbrace{\Delta I_{FOMO}}_{\text{情绪}}$$

### 3. 市场参与者画像 (The Participants)

我们将NPC抽象为三股互相拉扯的数学力量。它们的强度由**当前的市场剧本**（见第4节）决定。

#### A. $\Delta I_{Player}$ (玩家：点火者)

含义: 玩家的大额订单对流动性池造成的直接物理冲击。

公式:

$$\Delta I_{Player} = Q_{trade} \cdot \eta$$

- $Q_{trade}$: 玩家交易量（正为买，负为卖）。
- $\eta$ (流动性敏感度): 市场的深浅。大城市 $\eta$ 极小，鹈鹕镇 $\eta$ 较大。
- **逻辑:** 玩家是第一块投入湖面的石头，激起最初的涟漪。

#### B. $\Delta I_{Smart}$ (聪明钱：价值回归者)

含义: 理性的套利者（如皮埃尔、乔治）。他们只信奉模型一算出的“真相” $S_T$。

公式:

$$\Delta I_{Smart} = k_{smart} \cdot (S_T - P_{Final}(t))$$

- $k_{smart}$: 回归系数。
- **逻辑 (地心引力):** 当现价 $P_{Final}$ 远高于基本面 $S_T$ 时，差值为负，他们做空（压低价格）；反之则抄底。他们是市场的稳定器。

#### C. $\Delta I_{Trend}$ (技术派：趋势冲浪者)

含义: 看着K线图操作的投机客（如谢恩）。他们不关心土豆值多少钱，只关心均线是否金叉。

公式:

$$\Delta I_{Trend} = k_{trend} \cdot \text{sign}(P_{Final}(t) - MA_{n}(t))$$

- $MA_n$: $n$ 周期移动平均线。
- **逻辑 (惯性):** 如果价格在均线之上，他们就推着价格继续涨。这是市场出现“惯性”的原因。

#### D. $\Delta I_{FOMO}$ (韭菜：情绪放大器)

含义: 追涨杀跌的盲从者（如刘易斯、普通村民）。他们对“价格变化的加速度”最敏感。

公式:

$$\Delta I_{FOMO} = k_{fomo} \cdot (I(t) - I(t-1))$$

- $I(t) - I(t-1)$: 上一帧的涨跌幅。
- **逻辑 (正反馈):** 刚才玩家买入导致涨了？那我也买！这会导致价格在玩家停止操作后，依然莫名其妙地暴涨一段。

### 4. 随机市场剧本 (The Scenario Engine)

为了避免模型变得机械化，系统每天（或每几小时）会随机抽取一个“剧本”。剧本本质上是一组**参数修正器 (Modifiers)**，动态调整上述 $k$ 值，从而改变NPC的性格。

#### 剧本 I：死水一潭 (Liquidity Trap)

- **叙述:** “市场交投清淡，甚至连苍蝇飞过的声音都听得见。”
- **参数特征:**
  - $k_{smart} \to \text{High}$ (极高): 任何偏离都会被瞬间抹平。
  - $k_{fomo} \to 0$: 没人跟风。
- **现象:** 玩家试图拉升价格，但价格像被焊死了一样，瞬间回调。交易充满了挫败感。

#### 剧本 II：非理性繁荣 (Irrational Exuberance)

- **叙述:** “每个人都在谈论期货，连酒吧里的醉汉都觉得自己是股神。”
- **参数特征:**
  - $k_{smart} \to 0$: 理性消失。
  - $k_{fomo} \to \text{Extreme}$ (极高): 极其微小的上涨都会引发海啸般的跟风。
- **现象:** 玩家只需买入少量货物“点火”，就能引发一场壮观的泡沫，价格脱离地心引力飞向月球。

#### 剧本 III：恐慌踩踏 (Panic Selling)

- **叙述:** “坏消息在蔓延，恐惧支配了山谷。”
- **参数特征:**
  - **不对称性:** 对下跌的敏感度 $k_{down}$ 极高，对上涨的反应 $k_{up}$ 为零。
- **现象:** 任何卖单都会引发连锁崩盘，玩家试图“护盘”买入，瞬间被抛压淹没。

#### 剧本 IV：轧空风暴 (Short Squeeze)

- **叙述:** “空头不死，多头不止。过度做空者正在被屠杀。”
- **触发条件:** 价格严重偏离基本面，且剧本被激活。
- **参数特征 (逻辑反转):**
  - $k_{smart}$ 翻转为**正数**: 原本该“做空平抑价格”的聪明钱，因为保证金不足爆仓，被迫“买入平仓”。
- **现象:** 价格明明已经贵得离谱，却因为空头爆仓而出现违反直觉的二次垂直拉升。

# 五、 做市商（系统）逻辑

1. **唯一对手方**：系统是被动接受所有交易的唯一对手方。
2. **报价**：系统基于 $P_{\text{future}}(t)$ 提供双边报价（`Bid`/`Ask`），并通过 `Spread`（价差）盈利。
3. **交割执行**：在Day 28，严格执行实物交割（发邮件 / 查库存）。

#### 模块一：L2 动态订单簿 (The Living Order Book)

这是每一帧交易发生的物理战场。它不再是一个单一的价格点，而是一个基于概率分布生成的深度列表。

1. **快照生成 (Snapshot Generation)**:
   - 每一帧开始时，系统基于当前价格 $P_t$ 和市场情绪（看涨/看跌），生成背景 NPC 的挂单。
   - **看涨时**: 卖盘（Ask）稀疏，买盘（Bid）密集且激进。
   - **看跌时**: 卖盘堆积，买盘撤退。
2. **玩家注入 (Player Injection)**:
   - 玩家的**限价单 (Limit Orders)** 被物理插入到这个列表中。
   - **持久化**: 只要未成交且未撤单，玩家的单子就是列表中的一颗“钉子”，跨帧存在，直到被吃掉。

#### 模块二：交易执行逻辑 (The Execution Logic)

这是玩家与市场互动的直接规则。

**场景 A：玩家作为 Taker (市价单/吃单)**

- **行为**: 玩家扔出一笔资金，要求“立即成交”。
- **逻辑**:
  1. **扫单**: 从最优价（Best Ask/Bid）开始，逐层消耗 NPC 和挂单玩家的流动性。
  2. **滑点 (Slippage)**: 如果第一层不够吃，就吃第二层、第三层。玩家最终的**平均成交价 (VWAP)** 会劣于初始看到的现价。
  3. **冲击**: 吃掉的单量转化为 $\Delta I_{Player}$，直接推高/拉低下一帧的宏观价格基准。

**场景 B：玩家作为 Maker (限价单/挂单)**

- **行为**: 玩家指定价格（例如 100g），将资金摆在盘口。
- **逻辑**:
  1. **瞬时撮合**: 如果玩家挂单价优于对手盘（例如挂 100买，市场卖一仅 99），则立即作为 Taker 吃掉 99 的单子。
  2. **入册**: 如果无法立即成交，玩家订单进入 Order Book，成为**买一**或**卖一**，也就是成为了新的**市场价格边界**。
  3. **等待**: 等待后续的“虚拟流量”来撞击。

#### 模块三：虚拟流量与碰撞检测 (Virtual Flow & Collision)

这是连接宏观模型（模型四/五）与微观订单簿的桥梁。我们用**“能量流”**来模拟价格的移动。

1. **意图计算 (The Intention)**:
   - 模型四（布朗桥）+ 模型五（情绪层）计算出下一帧的**理论目标价** $P_{target}$。
   - 例如：当前价 100g，模型想跌到 98g。
2. **流量生成 (Flow Generation)**:
   - 系统计算：要让价格从 100 跌到 98，需要一股多大的**抛压 (Selling Pressure)**？
   - 这股抛压被具象化为一股**“虚拟市价卖单流”**。
3. **物理碰撞 (The Collision)**:
   - 这股虚拟卖单流开始向下俯冲，撞击买盘队列。
   - **如果撞到 NPC**: 瞬间击穿，价格下跌。
   - **如果撞到玩家 (The Wall)**:
     - 玩家挂单（例如 1000 个 @ 100g）开始消耗虚拟流量。
     - **情形一 (墙厚)**: 流量耗尽，玩家还剩 500 个。结果：**价格被死死钉在 100g**，模型预测的 98g 失败。
     - **情形二 (墙破)**: 玩家单子被吃光，流量还剩一点。结果：**价格跌穿 100g**，继续向下寻找新的平衡点。

#### 模块四：反馈循环 (The Feedback Loop)

微观的博弈结果会反向重写宏观参数。

- 成交即动量:

  玩家被“吃掉”的那部分单子（无论是主动吃还是被动挂单成交），都视为真实成交量。这将计入模型五的 $\Delta I_{Player}$，意味着玩家确实吸收了市场的抛压/买压，市场情绪会因此改变（例如：大额承接导致跌不动了，市场可能反转）。

- 挂单即心理:

  玩家未成交的巨额挂单，作为可见深度，会影响 NPC 的 $\Delta I_{Smart}$（认为此处有强支撑/强阻力），从而减缓未来的虚拟流量生成速度。

# 六、 技术实现核心 (Mod兼容性)

1. **UI不暂停**：Mod的交易UI界面**必须设置**为“打开时不暂停游戏时间”，这是实现高频交易和防止作弊的前提。
2. **“心脏”：混合时间模型**：
   - **波动频率（体感）**：与**真实时间**挂钩。
     - 使用 `helper.Events.GameLoop.UpdateTicked` (每帧触发)。
     - 在内部设置一个真实时间计时器 `REAL_TIME_TICK_INTERVAL` (例如 0.7秒)。
     - 每0.7真实秒执行一次 `UpdateMarketPrices()` 函数。
   - **价格趋势（逻辑）**：与**游戏时间**挂钩。
     - 在 `UpdateMarketPrices()` 函数内部，**必须读取 `Game1.timeOfDay`** 来计算当前是游戏内的“哪一分钟”（`timeRatio`）。
     - 所有的“理想路径” (`P_path`) 和“基差” (`DaysToExpiry`) 都基于这个 `Game1.timeOfDay` 来计算。
   - **完美兼容**：此模型自动适配骷髅洞穴（游戏时间变慢 -> `P_path` 移动变慢 -> `ΔP_drift` 变小 -> 市场横盘）和时间加速Mod（游戏时间变快 -> `P_path` 移动飞快 -> `ΔP_drift` 巨大 -> 市场趋势极强）。








