# Stardew Capital - æŠ€æœ¯è¦ç‚¹

> ä¸€ä¸ªä¸ºã€Šæ˜Ÿéœ²è°·ç‰©è¯­ã€‹æ‰“é€ çš„é‡‘èäº¤æ˜“æ¨¡æ‹Ÿ Mod
> 
> **æ ¸å¿ƒç†å¿µ**ï¼šå°†çº¯é‡‘èæ•°å­¦æ¨¡å‹ä¸æ¸¸æˆé€»è¾‘å®Œå…¨åˆ†ç¦»ï¼Œå®ç°å¯æ‰©å±•çš„é‡‘èäº¤æ˜“ç³»ç»Ÿ

---

## ğŸ“ æ¶æ„è®¾è®¡å“²å­¦

### åˆ†å±‚æ¶æ„åŸåˆ™

é¡¹ç›®é‡‡ç”¨ä¸¥æ ¼çš„**é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰**ï¼Œå°†ä»£ç åˆ†ä¸ºäº”ä¸ªç‹¬ç«‹å±‚æ¬¡ï¼š

```
Core å±‚ï¼ˆçº¯æ•°å­¦å¼•æ“ï¼‰
    â†“ ä¾èµ–
Domain å±‚ï¼ˆé‡‘èä¸šåŠ¡å®ä½“ï¼‰
    â†“ ä¾èµ–
Services å±‚ï¼ˆç³»ç»Ÿè¿è½¬é€»è¾‘ï¼‰
    â†“ ä¾èµ–
UI å±‚ï¼ˆäº¤äº’ç•Œé¢ï¼‰
    â†“ ä¾èµ–
Integration å±‚ï¼ˆæ¸¸æˆé€‚é…ï¼‰
```

**å…³é”®è®¾è®¡çº¦æŸ**ï¼š
- `Core` å±‚**ç»ä¸**å¼•ç”¨ `StardewValley` å‘½åç©ºé—´ï¼Œä¿æŒçº¯æ•°å­¦è®¡ç®—çš„ç‹¬ç«‹æ€§
- æ‰€æœ‰æœåŠ¡é€šè¿‡**æ¥å£ï¼ˆInterfaceï¼‰**é€šä¿¡ï¼Œä¸ºæœªæ¥æ‰©å±•ï¼ˆè‚¡ç¥¨ã€æœŸæƒï¼‰é¢„ç•™ç©ºé—´
- æ—¶é—´ç³»ç»Ÿé€šè¿‡ `IGameTimeProvider` æŠ½è±¡ï¼Œæ”¯æŒæ—¶é—´åŠ é€Ÿ/å†»ç»“è°ƒè¯•

---

## ğŸ¯ æ ¸å¿ƒæŠ€æœ¯ç‰¹æ€§

### 1. åŒä»·æ ¼ç³»ç»Ÿï¼šå½±å­ä»·æ ¼ + æ’®åˆä»·æ ¼

è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿæœ€æ ¸å¿ƒçš„åˆ›æ–°è®¾è®¡ï¼Œé‡‡ç”¨**é¢„ç”Ÿæˆ + å®æ—¶å åŠ **çš„æ··åˆæ¨¡å‹ã€‚

#### å½±å­ä»·æ ¼ï¼ˆShadow Priceï¼‰- å¸‚åœºåŠ¿èƒ½

- **æ¥æº**ï¼šå­£åº¦å¼€å§‹æ—¶é¢„ç”Ÿæˆæ•´ä¸ªèµ›å­£çš„ä»·æ ¼è½¨è¿¹
- **ä½œç”¨**ï¼šä»£è¡¨"å¸‚åœºæ„æ„¿"ï¼Œå¦‚åŒæ°´åº“ä¸­çš„æ°´ä½é«˜åº¦
- **æŠ€æœ¯å®ç°**ï¼š[`FuturesShadowGenerator.cs`](file:///e:/work/stardew_capital/Src/Services/Pricing/Generators/FuturesShadowGenerator.cs)

```csharp
// é¢„ç”Ÿæˆæ•´ä¸ªå­£åº¦çš„å½±å­ä»·æ ¼
public FuturesMarketState Generate(CommodityFutures futures, ...)
{
    var dailyData = GenerateSeasonalData(futures, ...);
    // è¿”å›åŒ…å«æ¯æ—¥å½±å­ä»·æ ¼çš„æ•°æ®ç»“æ„
}
```

#### æ’®åˆä»·æ ¼ï¼ˆMatch Priceï¼‰- å®é™…äº¤æ˜“ä»·æ ¼

- **æ¥æº**ï¼šè®¢å•ç°¿ï¼ˆOrder Bookï¼‰ç¢°æ’çš„å®é™…ç»“æœ
- **ä½œç”¨**ï¼šç©å®¶å’Œ NPC çœŸå®åšå¼ˆåçš„æˆäº¤ä»·
- **æ ¸å¿ƒå…¬å¼**ï¼š

$$
P_{Final}(t) = P_{Shadow}(t) + I_{Impact}(t)
$$

å…¶ä¸­ $I_{Impact}(t)$ ç”±å¤šæ–¹åŠ›é‡åšå¼ˆå†³å®šï¼š

$$
I(t+1) = I(t) + \Delta I_{Player} + \Delta I_{Smart} + \Delta I_{Trend} + \Delta I_{FOMO}
$$

**åŠ¿èƒ½å·®é©±åŠ¨æµé‡æœºåˆ¶**ï¼š

```csharp
// è®¡ç®—å½±å­ä»·æ ¼ä¸æ’®åˆä»·æ ¼çš„åŠ¿èƒ½å·®
float priceGap = shadowPrice - currentMatchPrice;

// è½¬åŒ–ä¸ºè™šæ‹Ÿè®¢å•æµ
int flowAmount = (int)(Abs(priceGap) * liquidityCoefficient);

// è™šæ‹Ÿè®¢å•å†²å‡»è®¢å•ç°¿
orderBook.ProcessVirtualOrder(priceGap > 0 ? Buy : Sell, flowAmount);
```

**å®æˆ˜æ•ˆæœ**ï¼š
- âœ… ç©å®¶æŒ‚é™ä»·å•å¯çœŸå®"å¡ä½"ä»·æ ¼
- âœ… åŠ¿èƒ½å·®è¶Šå¤§ï¼Œè™šæ‹Ÿè®¢å•æµè¶Šå¼ºï¼Œæœ€ç»ˆå¯¼è‡´"å¤§åå´©å¡Œ"å¼çš„ç€‘å¸ƒè¡Œæƒ…
- âœ… èªæ˜é’± NPC ä¼šè‡ªåŠ¨å¥—åˆ©ï¼Œå°†ä»·æ ¼æ‹‰å›å½±å­ä»·æ ¼

---

### 2. å››å±‚ä»·æ ¼æ¨¡å‹ - ä»å®è§‚åˆ°å¾®è§‚

#### æ¨¡å‹ä¸€ï¼šåŸºæœ¬é¢ä»·å€¼ï¼ˆFundamental Valueï¼‰

**æ ¸å¿ƒç±»**ï¼š[`FundamentalEngine.cs`](file:///e:/work/stardew_capital/Src/Services/Pricing/FundamentalEngine.cs)

è®¡ç®—å•†å“çš„"çœŸå®ä»·å€¼"ï¼Œè€ƒè™‘ï¼š
- å­£èŠ‚æ€§ä¹˜æ•°ï¼ˆå¤å­£è‰è“ä»·æ ¼é«˜ï¼‰
- ä¾›éœ€æ–°é—»å†²å‡»ï¼ˆè™«ç¾ â†’ ä¾›ç»™ä¸‹é™ â†’ ä»·æ ¼ä¸Šæ¶¨ï¼‰
- ä¾¿åˆ©æ”¶ç›Šç‡ï¼ˆConvenience Yieldï¼‰

```csharp
public double CalculateFundamentalValue(string symbol, ...)
{
    var baseValue = commodity.BasePrice;
    var seasonalMultiplier = GetSeasonalMultiplier(symbol, season);
    var newsImpact = CalculateNewsImpact(activeNews);
    
    return baseValue * seasonalMultiplier * (1 + newsImpact);
}
```

#### æ¨¡å‹äºŒï¼šæ—¥é—´æ”¶æ•›ï¼ˆGBM - å‡ ä½•å¸ƒæœ—è¿åŠ¨ï¼‰

**æ ¸å¿ƒç±»**ï¼š[`GBM.cs`](file:///e:/work/stardew_capital/Src/Core/Math/GBM.cs)

æœŸè´§ä»·æ ¼æ¯å¤©å‘åŸºæœ¬é¢ä»·å€¼**å‡å€¼å›å½’**ï¼ŒåŒæ—¶å¸¦æœ‰éšæœºæ³¢åŠ¨ã€‚

**æ•°å­¦å…¬å¼**ï¼š

$$
\ln(S_{t+1}) = \ln(S_t) + \alpha \cdot (\ln(Target) - \ln(S_t)) + \sigma_t \cdot \epsilon
$$

- $\alpha = \frac{1}{T-t}$ï¼šå›å½’ç³»æ•°ï¼Œå‰©ä½™å¤©æ•°è¶Šå°‘ï¼Œæ”¶æ•›è¶Šå¼º
- $\sigma_t = \sigma_{base} \cdot \sqrt{T-t}$ï¼šåŠ¨æ€æ³¢åŠ¨ç‡ï¼Œä¸´è¿‘åˆ°æœŸæ—¥æ³¢åŠ¨å‡å°

**å…³é”®ç‰¹æ€§**ï¼š
- åˆ°æœŸæ—¥å½“å¤©å¼ºåˆ¶æ”¶æ•›åˆ°ç›®æ ‡ä»·æ ¼
- å¯¹æ•°ç©ºé—´è¿ç®—ç¡®ä¿ä»·æ ¼æ°¸è¿œä¸ºæ­£

#### æ¨¡å‹ä¸‰ï¼šæ—¥å†…å¸ƒæœ—æ¡¥ï¼ˆBrownian Bridgeï¼‰

**æ ¸å¿ƒç±»**ï¼š[`BrownianBridge.cs`](file:///e:/work/stardew_capital/Src/Core/Math/BrownianBridge.cs)

æ¨¡æ‹Ÿ 10 åˆ†é’Ÿçº§åˆ«çš„ç›˜ä¸­æ³¢åŠ¨ï¼Œç¡®ä¿æ”¶ç›˜ä»·ç²¾ç¡®å›åˆ°ç›®æ ‡ä»·ã€‚

**æ•°å­¦å…¬å¼**ï¼š

$$
P_{\tau+1} = P_\tau + \underbrace{(Target - P_\tau) \cdot \frac{\Delta t}{1-\tau}}_{\text{å¼•åŠ›é¡¹}} + \underbrace{\sigma_{intra} \cdot \Psi(\tau) \cdot \epsilon \cdot \sqrt{\Delta t}}_{\text{å™ªå£°é¡¹}}
$$

**æ³¢åŠ¨ç‡å¾®ç¬‘å› å­** $\Psi(\tau)$ï¼š

$$
\Psi(\tau) = (1 + 2.0 \cdot e^{-10\tau}) \cdot \sqrt{1-\tau}
$$

- å¼€ç›˜æ—¶æ³¢åŠ¨å‰§çƒˆï¼ˆ$e^{-10 \cdot 0} = 1$ï¼‰
- æ”¶ç›˜æ—¶æ³¢åŠ¨å½’é›¶ï¼ˆ$\sqrt{1-1} = 0$ï¼‰

#### æ¨¡å‹å››ï¼šè™šæ‹Ÿæµé‡ä¸ NPC ä»£ç†

**æ ¸å¿ƒç±»**ï¼š[`NPCAgentManager.cs`](file:///e:/work/stardew_capital/Src/Services/Market/NPCAgentManager.cs)

ä¸‰ç±» NPC ä»£ç†äº§ç”Ÿå·®å¼‚åŒ–çš„å¸‚åœºåŠ›é‡ï¼š

| ä»£ç†ç±»å‹ | äº¤æ˜“é€»è¾‘ | æ•°å­¦å…¬å¼ | å¸‚åœºä½œç”¨ |
|---------|---------|---------|---------|
| **Smart Moneyï¼ˆèªæ˜é’±ï¼‰** | åŸºæœ¬é¢å›å½’ | $k_{smart} \cdot (S_T - P_{current})$ | ä»·æ ¼ç¨³å®šå™¨ |
| **Trend Followersï¼ˆè¶‹åŠ¿æ´¾ï¼‰** | è¿½éšç§»åŠ¨å‡çº¿ | $k_{trend} \cdot \text{sign}(P - MA_n)$ | æƒ¯æ€§åˆ¶é€ è€… |
| **FOMO Tradersï¼ˆéŸ­èœï¼‰** | è¿½æ¶¨æ€è·Œ | $k_{fomo} \cdot \Delta P \cdot (1 + asymmetric)$ | æƒ…ç»ªæ”¾å¤§å™¨ |

**ä¸å¯¹ç§°ææ…Œæœºåˆ¶**ï¼šä¸‹è·Œæ—¶ FOMO åŠ›é‡åŠ å€ï¼Œæ¨¡æ‹Ÿè¸©è¸æ•ˆåº”ã€‚

---

### 3. æ–°é—»äº‹ä»¶ç³»ç»Ÿ - å™äº‹é©±åŠ¨çš„å¸‚åœº

**æ ¸å¿ƒç±»**ï¼š[`NewsGenerator.cs`](file:///e:/work/stardew_capital/Src/Services/News/NewsGenerator.cs)

#### æ–°é—»åŠ è½½ä¸ç”Ÿæˆ

æ–°é—»æ¨¡æ¿å­˜å‚¨åœ¨ JSON é…ç½®ä¸­ï¼Œæ”¯æŒï¼š
- **æ¯æ—¥æ–°é—»**ï¼šå½±å“æ•´ä¸ªäº¤æ˜“æ—¥ï¼ˆå¦‚"æ—±ç¾è­¦å‘Š"ï¼‰
- **ç›˜ä¸­çªå‘**ï¼šå¼€ç›˜åéšæœºè§¦å‘ï¼ˆå¦‚"æ”¿ç­–å˜åŠ¨"ï¼‰

```json
{
  "id": "drought_warning",
  "title": "æ°”è±¡å±€å‘å¸ƒæ—±ç¾é¢„è­¦",
  "description": "æœªæ¥ä¸€å‘¨é™é›¨é‡ä¸è¶³...",
  "type": "supply_shock",
  "demand_impact": 0,
  "supply_impact": -15,
  "duration_days": 7
}
```

#### æ–°é—»å¯¹ä»·æ ¼çš„å½±å“è·¯å¾„

```
æ–°é—»è§¦å‘
    â†“
FundamentalEngine è°ƒæ•´åŸºæœ¬é¢ä»·å€¼
    â†“
GBM é‡æ–°è®¡ç®—ç›®æ ‡ä»·æ ¼
    â†“
å½±å­ä»·æ ¼æ›²çº¿åŠ¨æ€æ›´æ–°
    â†“
Smart Money æ£€æµ‹åå·® â†’ äº§ç”Ÿå¥—åˆ©æµé‡
```

**å…³é”®åˆ›æ–°**ï¼šæ–°é—»åœ¨**é¢„ç”Ÿæˆé˜¶æ®µ**å°±å·²èå…¥å½±å­ä»·æ ¼è®¡ç®—ï¼Œç¡®ä¿ä»·æ ¼è½¨è¿¹è¿è´¯æ€§ã€‚

---

### 4. æ··åˆæ—¶é—´ç³»ç»Ÿ - çœŸå®æ—¶é—´ Ã— æ¸¸æˆæ—¶é—´

**æ ¸å¿ƒç±»**ï¼š[`MixedTimeClock.cs`](file:///e:/work/stardew_capital/Src/Core/Time/MixedTimeClock.cs)

#### æ—¶é—´å½’ä¸€åŒ–

å°†æ¸¸æˆæ—¶é—´ï¼ˆ600-1400ï¼‰æ˜ å°„åˆ° [0.0, 1.0] çš„å½’ä¸€åŒ–è¿›åº¦ï¼š

```csharp
public double GetDayProgress()
{
    int time = _timeProvider.CurrentTimeOfDay;
    int marketOpen = 600;
    int marketClose = 1400;
    
    return (time - marketOpen) / (double)(marketClose - marketOpen);
}
```

#### éæš‚åœ UIï¼ˆNon-Pausing UIï¼‰

**æŠ€æœ¯æŒ‘æˆ˜**ï¼šåŸç‰ˆæ¸¸æˆæ‰“å¼€èœå•æ—¶ä¼šæš‚åœæ—¶é—´

**è§£å†³æ–¹æ¡ˆ**ï¼šHarmony è¡¥ä¸å¼ºåˆ¶æ—¶é—´æµé€

[`TimePatch.cs`](file:///e:/work/stardew_capital/Src/Patches/TimePatch.cs) æ‹¦æˆªä¸¤ä¸ªå…³é”®æ–¹æ³•ï¼š

```csharp
[HarmonyPostfix]
[HarmonyPatch(typeof(Game1), nameof(Game1.shouldTimePass))]
public static void ShouldTimePass_Postfix(ref bool __result)
{
    // æ£€æµ‹åˆ°äº¤æ˜“èœå•æ‰“å¼€ â†’ å¼ºåˆ¶è¿”å› true
    if (!__result && Game1.activeClickableMenu is TradingMenu)
    {
        __result = true;
    }
}
```

**æ¸¸æˆè®¾è®¡æ„ä¹‰**ï¼š
- ğŸš« é˜²æ­¢ç©å®¶"æš‚åœè§‚å¯Ÿ"å†å†³ç­–ï¼ˆåä½œå¼Šï¼‰
- âš¡ å®ç°é«˜é¢‘äº¤æ˜“æœºåˆ¶
- ğŸ“ˆ ä»·æ ¼åœ¨ UI ä¸­å®æ—¶æ³¢åŠ¨ï¼Œå¢å¼ºç´§å¼ æ„Ÿ

---

### 5. è®¢å•ç°¿ä¸æ’®åˆå¼•æ“

**æ ¸å¿ƒç±»**ï¼š`OrderBook.cs`ï¼Œ`VirtualFlowProcessor.cs`

#### L2 è®¢å•æ·±åº¦

ç»´æŠ¤ä¹°å–åŒå‘æ·±åº¦é˜Ÿåˆ—ï¼š

```csharp
public class OrderBook
{
    private SortedDictionary<double, Queue<LimitOrder>> _bidLevels; // ä¹°å•
    private SortedDictionary<double, Queue<LimitOrder>> _askLevels; // å–å•
}
```

#### è™šæ‹Ÿè®¢å•æµç¢°æ’

å½“å½±å­ä»·æ ¼ä¸æ’®åˆä»·æ ¼å­˜åœ¨åŠ¿èƒ½å·®æ—¶ï¼š

```
è®¡ç®—è™šæ‹Ÿè®¢å•é‡ = Gap Ã— LiquidityCoefficient
           â†“
è™šæ‹Ÿè®¢å•å†²å‡»è®¢å•ç°¿
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¢°åˆ° NPC è®¢å• â†’ ç¬é—´å‡»ç©¿  â”‚
â”‚ ç¢°åˆ°ç©å®¶è®¢å• â†’ æ¶ˆè€—æµé‡  â”‚
â”‚   â”œâ”€ æµé‡è€—å°½ â†’ ä»·æ ¼å¡ä½ â”‚
â”‚   â””â”€ å¢™è¢«å‡»ç©¿ â†’ ä»·æ ¼çªç ´ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®æˆ˜æ¡ˆä¾‹**ï¼šå¤§åå´©å¡Œï¼ˆDam Breakï¼‰

```
10:00 - ç©å®¶åœ¨ 100g æŒ‚ 1000 ä¹°å•ï¼ˆç­‘å¢™ï¼‰
10:10 - å½±å­ä»·æ ¼ 95gï¼ŒåŠ¿èƒ½å·® 5g â†’ å°æµé‡æ”»å‡»
10:30 - å½±å­ä»·æ ¼ 85gï¼ŒåŠ¿èƒ½å·® 15g â†’ æ°´å‹å‰§å¢
10:35 - ç©å®¶è®¢å•è€—å°½ â†’ å¢™ç ´
        â†’ å·¨å¤§åŠ¿èƒ½å·®ç¬é—´é‡Šæ”¾
        â†’ ä»·æ ¼ä» 100g é—ªå´©è‡³ 85gï¼ˆè¶…é•¿é˜´çº¿ï¼‰
```

---

### 6. ç†”æ–­æœºåˆ¶ä¸éš”å¤œè·³ç©º

**æ ¸å¿ƒç±»**ï¼š[`CircuitBreakerService.cs`](file:///e:/work/stardew_capital/Src/Services/Market/CircuitBreakerService.cs)

#### ç†”æ–­è§¦å‘æ¡ä»¶

```csharp
public bool CheckCircuitBreaker(CommodityFutures futures, double newPrice)
{
    double priceChange = (newPrice - futures.OpenPrice) / futures.OpenPrice;
    double timeRatio = _clock.GetDayProgress();
    
    // ä¸´è¿‘æ”¶ç›˜ + ä»·æ ¼å‰§çƒˆæ³¢åŠ¨ â†’ è§¦å‘ç†”æ–­
    if (timeRatio > 0.9 && Math.Abs(priceChange) > 0.05)
    {
        return true;
    }
}
```

#### éš”å¤œè·³ç©ºï¼ˆOvernight Gapï¼‰

æ–°é—»åœ¨ç›˜åè§¦å‘æ—¶ï¼Œæ¬¡æ—¥å¼€ç›˜ä»·ç›´æ¥è·³ç©ºï¼š

```csharp
public void ApplyOvernightGap(CommodityFutures futures)
{
    double overnightNews = GetOvernightNewsImpact();
    futures.Gap = overnightNews;
    futures.OpenPrice = futures.ClosePrice * (1 + futures.Gap);
}
```

**K çº¿å›¾æ•ˆæœ**ï¼šå‡ºç°æ˜æ˜¾çš„ä¸Šä¸‹è·³ç©ºç¼ºå£

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### ä¾èµ–æ³¨å…¥ä¸æœåŠ¡ç®¡ç†

[`ModEntry.cs`](file:///e:/work/stardew_capital/Src/ModEntry.cs) ä¸­æ‰‹åŠ¨æ„é€ ä¾èµ–å…³ç³»ï¼š

```csharp
// åˆå§‹åŒ–é¡ºåºä¸¥æ ¼éµå®ˆä¾èµ–å±‚æ¬¡
_timeProvider = new StardewTimeProvider();
_clock = new MixedTimeClock(_timeProvider, _config);
_priceEngine = new PriceEngine(_clock, ...);
_marketManager = new MarketManager(_priceEngine, ...);
```

### å­˜æ¡£ç³»ç»Ÿ

**æ ¸å¿ƒç±»**ï¼š[`PersistenceService.cs`](file:///e:/work/stardew_capital/Src/Services/Infrastructure/PersistenceService.cs)

ä¿å­˜å†…å®¹ï¼š
- ç©å®¶æŒä»“ï¼ˆPositionï¼‰å’Œè´¦æˆ·ä½™é¢
- å¸‚åœºçŠ¶æ€ï¼ˆå½“å‰å½±å­ä»·æ ¼ã€ç´¯è®¡å†²å‡»ï¼‰
- å†å²æ–°é—»äº‹ä»¶

é‡‡ç”¨ SMAPI çš„ `helper.Data.WriteSaveData()` æœºåˆ¶ã€‚

### Web è°ƒè¯•ç•Œé¢

**æ ¸å¿ƒç±»**ï¼š[`WebServer.cs`](file:///e:/work/stardew_capital/Src/Services/Infrastructure/WebServer.cs)

æä¾› HTTP API å®æ—¶æŸ¥çœ‹ï¼š
- `/api/ticker`ï¼šå½“å‰ä»·æ ¼ã€å½±å­ä»·æ ¼ã€NPC åŠ›é‡åˆ†å¸ƒ
- å¯è§†åŒ–å¸‚åœºå†…éƒ¨çŠ¶æ€ï¼Œè¾…åŠ©è°ƒè¯•

---

## ğŸ® æ¸¸æˆè®¾è®¡äº®ç‚¹

### 1. å¥—åˆ©æœºä¼šå¯è§†åŒ–

UI æ˜¾ç¤ºä¸¤ä¸ªä»·æ ¼ï¼š
- **å½“å‰ä»·** $P_{Final}$ - çº¢è‰²/ç»¿è‰²
- **å½±å­ä»·** $P_{Shadow}$ - ç°è‰²è™šçº¿

**ç©å®¶ç­–ç•¥**ï¼šå½“å·®è·è¿‡å¤§æ—¶ï¼Œå¯é¢„åˆ¤ä»·æ ¼å›å½’æ–¹å‘è¿›è¡Œå¥—åˆ©ã€‚

### 2. éš¾åº¦å‚æ•°è°ƒèŠ‚

é€šè¿‡ä¿®æ”¹ `market_rules.json` çš„ç³»æ•°ï¼š

```json
{
  "npcAgents": {
    "smartMoney": { "baseStrength": 0.05 },  // â†‘ å¢å¤§ = å¸‚åœºæ›´ç¨³å®š
    "fomoTraders": { "baseStrength": 0.02 }  // â†‘ å¢å¤§ = å®¹æ˜“æš´æ¶¨æš´è·Œ
  }
}
```

- **ç®€å•æ¨¡å¼**ï¼šèªæ˜é’±å ä¸»å¯¼ â†’ ä»·æ ¼ç†æ€§
- **å›°éš¾æ¨¡å¼**ï¼šFOMO éŸ­èœæ´»è·ƒ â†’ æç«¯è¡Œæƒ…é¢‘å‘

### 3. é˜²ä½œå¼Šè®¾è®¡

- âœ… æ—¶é—´ä¸å¯æš‚åœ â†’ æ— æ³•"çœ‹ä¸€çœ¼å°±å…³é—­ç­‰å¾…æ—¶æœº"
- âœ… å½±å­ä»·æ ¼ä¸å¯è§ï¼ˆé»˜è®¤ï¼‰â†’ éœ€å‡çº§ç»ˆç«¯è§£é”
- âœ… è‡ªåŠ¨ä¿®å¤æœºåˆ¶ â†’ ä»·æ ¼å¼‚å¸¸æ—¶èªæ˜é’±è‡ªåŠ¨æ‹‰å›

---

## ğŸ“š æ‰©å±•æ€§è®¾è®¡

### ä¸ºæœªæ¥é‡‘èäº§å“é¢„ç•™æ¥å£

#### é€šç”¨äº¤æ˜“æ¥å£

```csharp
public interface ITradable
{
    string Symbol { get; }
    double CurrentPrice { get; }
    double MarginRatio { get; }  // æœŸè´§ 10%ï¼Œè‚¡ç¥¨ 100%
}
```

æœªæ¥å¯æ·»åŠ ï¼š
- `Stock.cs`ï¼šè‚¡ç¥¨ï¼ˆæ— åˆ°æœŸæ—¥ï¼‰
- `Option.cs`ï¼šæœŸæƒï¼ˆéœ€é›†æˆ Black-Scholes æ¨¡å‹ï¼‰

#### å¯æ’æ‹”çš„ä»·æ ¼å¼•æ“

```csharp
public interface IPriceGenerator
{
    double CalculateNextPrice(double current, double target, ...);
}
```

å¯æ›¿æ¢ä¸ºæ›´å¤æ‚çš„æ¨¡å‹ï¼ˆå¦‚ GARCHã€è·³è·ƒæ‰©æ•£è¿‡ç¨‹ï¼‰ã€‚

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### é¢„ç”Ÿæˆç­–ç•¥

- âœ… æ•´ä¸ªå­£åº¦çš„å½±å­ä»·æ ¼åœ¨å­£åˆä¸€æ¬¡æ€§è®¡ç®—å®Œæˆ
- âœ… è¿è¡Œæ—¶åªéœ€æŸ¥è¡¨ + ç®€å•åŠ å‡æ³•
- âœ… é¿å…æ¯å¸§é‡å¤è¿è¡Œ GBM/å¸ƒæœ—æ¡¥

### èŠ‚æµæœºåˆ¶

```csharp
private int _tickCounter = 0;
private const int UPDATE_INTERVAL = 4; // æ¯ 4 å¸§æ›´æ–°ä¸€æ¬¡

public void Update(int currentTick)
{
    if (currentTick % UPDATE_INTERVAL != 0) return;
    // ... ä»·æ ¼è®¡ç®—
}
```

å‡å°‘é«˜é¢‘è®¡ç®—å¯¹å¸§ç‡çš„å½±å“ã€‚

---

## ğŸ”¬ æ•°å­¦æ¨¡å‹æ€»ç»“

| æ¨¡å‹ | æ—¶é—´å°ºåº¦ | æ ¸å¿ƒç®—æ³• | ä½œç”¨ |
|------|---------|---------|------|
| **Fundamental Engine** | å­£åº¦çº§ | å­£èŠ‚ç³»æ•° Ã— æ–°é—»å†²å‡» | å®šä¹‰ä»·æ ¼é”šç‚¹ |
| **GBM** | æ—¥çº§ | å¯¹æ•°å‡å€¼å›å½’ + éšæœºæ¸¸èµ° | æ¯æ—¥æ”¶ç›˜ä»·æ”¶æ•› |
| **Brownian Bridge** | 10åˆ†é’Ÿçº§ | å¼•åŠ› + æ³¢åŠ¨ç‡å¾®ç¬‘ | æ—¥å†…å¹³æ»‘è½¨è¿¹ |
| **NPC Agents** | å¸§çº§ | å¤šæ™ºèƒ½ä½“åšå¼ˆ | çŸ­æœŸæƒ…ç»ªæ³¢åŠ¨ |

**å…¬å¼ç»Ÿä¸€å½¢æ€**ï¼š

$$
\boxed{P_{observed} = P_{deterministic} + \sum_{agents} \Delta I_{stochastic}}
$$

å°†ç¡®å®šæ€§è¶‹åŠ¿ä¸éšæœºæ€§åšå¼ˆå®Œç¾ç»“åˆã€‚

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **è¯­è¨€**ï¼šC# 10 (.NET 6)
- **æ¡†æ¶**ï¼šSMAPI 4.1.1
- **å­—èŠ‚ç ä¿®æ”¹**ï¼šHarmony 2.2.2
- **é…ç½®æ ¼å¼**ï¼šJSONï¼ˆå«æ³¨é‡Šæ”¯æŒï¼‰
- **è°ƒè¯•å·¥å…·**ï¼šå†…ç½® HTTP Serverï¼ˆå¯é€‰ï¼‰

---

## ğŸ“– å‚è€ƒæ–‡çŒ®

é¡¹ç›®æ•°å­¦æ¨¡å‹çµæ„Ÿæ¥æºï¼š
1. **å‡å€¼å›å½’æ¨¡å‹**ï¼šOrnstein-Uhlenbeck Process
2. **å¸ƒæœ—æ¡¥ç†è®º**ï¼šæ ‡å‡†é‡‘èå·¥ç¨‹æ•™æ
3. **ä»£ç†å»ºæ¨¡**ï¼šAgent-Based Computational Economics (ACE)

---

## ğŸ¯ æ€»ç»“

Stardew Capital çš„æ ¸å¿ƒæŠ€æœ¯åˆ›æ–°åœ¨äºï¼š

1. **åŒä»·æ ¼ç³»ç»Ÿ** - å°†"å‰§æœ¬"ï¼ˆå½±å­ä»·æ ¼ï¼‰ä¸"äº’åŠ¨"ï¼ˆæ’®åˆä»·æ ¼ï¼‰è§£è€¦
2. **å››å±‚æ¨¡å‹åµŒå¥—** - ä»å®è§‚åŸºæœ¬é¢åˆ°å¾®è§‚ Tick çº§è”è®¡ç®—
3. **åŠ¿èƒ½é©±åŠ¨æµé‡** - ç”¨ç‰©ç†å­¦æ€ç»´è§£å†³"é¢„ç”Ÿæˆ vs ç©å®¶å¹²é¢„"çš„çŸ›ç›¾
4. **æ—¶é—´å·¥ç¨‹** - çªç ´åŸç‰ˆé™åˆ¶ï¼Œå®ç°çœŸå®é‡‘èå¸‚åœºä½“éªŒ

æ•´ä¸ªç³»ç»Ÿæ—¢æœ‰æ‰å®çš„é‡‘èæ•°å­¦åŸºç¡€ï¼Œåˆä¿æŒäº†æ¸¸æˆçš„è¶£å‘³æ€§å’Œå¯ç©æ€§ï¼Œæ˜¯**æŠ€æœ¯ä¸è®¾è®¡çš„å®Œç¾èåˆ**ã€‚
