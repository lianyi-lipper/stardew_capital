<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stardew Capital Trading Terminal</title>

    <!-- External Libraries -->
    <script src="lib/lightweight-charts.standalone.production.js"></script>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div style="display: flex; align-items: center; gap: 15px;">
                <button onclick="window.location.href='market_list.html'"
                    style="background: rgba(76, 175, 80, 0.2); border: 1px solid #4caf50; color: #4caf50; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: all 0.3s;"
                    onmouseover="this.style.background='#4caf50'; this.style.color='white';"
                    onmouseout="this.style.background='rgba(76, 175, 80, 0.2)'; this.style.color='#4caf50';">
                    ‚Üê ËøîÂõûÂàóË°®
                </button>
                <div class="logo">üí∞ STARDEW CAPITAL</div>
            </div>

            <!-- Price Info -->
            <div style="text-align: center;">
                <div class="price-display" id="price-display">-- g</div>
                <div style="font-size: 12px; color: #aaa;">
                    <span id="symbol-display">PARSNIP</span> |
                    Spot: <span id="spot-price">--</span> |
                    Basis: <span id="basis-price">--</span>
                </div>
            </div>

            <!-- Risk Info -->
            <div class="risk-info">
                <div class="risk-item">
                    <span class="risk-label">Equity</span>
                    <span class="risk-value" id="equity-val">--</span>
                </div>
                <div class="risk-item">
                    <span class="risk-label">Margin Level</span>
                    <span class="risk-value" id="margin-level">--</span>
                </div>
                <div class="status" id="status">Connecting...</div>
            </div>
        </header>

        <!-- Chart -->
        <div class="chart-section">
            <div
                style="position: absolute; top: 20px; right: 20px; z-index: 10; display: flex; gap: 10px; align-items: center;">
                <label style="font-size: 12px;">
                    <input type="checkbox" id="show-impact" onchange="toggleImpact()">
                    <span style="color: #ff9800;">Impact</span>
                </label>
            </div>
            <div id="chart-container"></div>
        </div>

        <!-- Sidebar (Right) -->
        <div class="sidebar">
            <!-- Order Book Panel -->
            <div class="panel orderbook-panel">
                <div class="panel-header">üìä ËÆ¢ÂçïÁ∞ø (L2)</div>
                <div class="orderbook-container" id="orderbook">
                    <div class="loading">Âä†ËΩΩ‰∏≠...</div>
                </div>
            </div>

            <!-- News Panel -->
            <div class="panel news-panel">
                <div class="panel-header">
                    üì∞ Êñ∞Èóª
                    <button id="btn-news-history" onclick="toggleNewsHistory()"
                        style="float: right; background: none; border: 1px solid #4caf50; color: #4caf50; padding: 2px 8px; border-radius: 3px; cursor: pointer; font-size: 10px;">
                        History
                    </button>
                </div>
                <div class="news-container" id="news-list">
                    <div class="loading">Âä†ËΩΩ‰∏≠...</div>
                </div>
            </div>
        </div>

        <!-- Trading Section (Bottom) -->
        <div class="trading-section">
            <!-- Market Order Panel -->
            <div class="trading-panel">
                <div class="panel-title">‚ö° Â∏Ç‰ª∑Âçï (Market Order)</div>
                <div class="form-group">
                    <label>Êï∞Èáè:</label>
                    <input type="number" id="market-quantity" value="10" min="1">
                </div>
                <div class="form-group">
                    <label>Êù†ÊùÜ:</label>
                    <select id="market-leverage">
                        <option value="1">1x</option>
                        <option value="5">5x</option>
                        <option value="10" selected>10x</option>
                    </select>
                </div>
                <button class="btn btn-buy" onclick="placeMarketOrder(true)">Â∏Ç‰ª∑‰π∞ÂÖ•</button>
                <button class="btn btn-sell" onclick="placeMarketOrder(false)">Â∏Ç‰ª∑ÂçñÂá∫</button>
            </div>

            <!-- Limit Order Panel -->
            <div class="trading-panel">
                <div class="panel-title">üìå Èôê‰ª∑Âçï (Limit Order)</div>
                <div class="form-group">
                    <label>‰ª∑Ê†º:</label>
                    <input type="number" id="limit-price" value="40" step="0.1" min="0">
                </div>
                <div class="form-group">
                    <label>Êï∞Èáè:</label>
                    <input type="number" id="limit-quantity" value="10" min="1">
                </div>
                <div class="form-group">
                    <label>Êù†ÊùÜ:</label>
                    <select id="limit-leverage">
                        <option value="1">1x</option>
                        <option value="5">5x</option>
                        <option value="10" selected>10x</option>
                    </select>
                </div>
                <button class="btn btn-buy" onclick="placeLimitOrder(true)">Èôê‰ª∑‰π∞ÂÖ•</button>
                <button class="btn btn-sell" onclick="placeLimitOrder(false)">Èôê‰ª∑ÂçñÂá∫</button>

                <div class="panel-title" style="margin-top: 15px; font-size: 12px;">ÊàëÁöÑÊåÇÂçï</div>
                <div class="order-list" id="pending-orders">
                    <div class="loading">ÊöÇÊó†ÊåÇÂçï</div>
                </div>
            </div>

            <!-- Positions Panel -->
            <div class="trading-panel">
                <div class="panel-title">üíº ÊåÅ‰ªì (Positions)</div>
                <div class="position-list" id="positions">
                    <div class="loading">ÊöÇÊó†ÊåÅ‰ªì</div>
                </div>
                <button class="btn btn-close" onclick="closeAllPositions()">Âπ≥‰ªìÊâÄÊúâ</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/chart.js"></script>
    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
</body>

</html>